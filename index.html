<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <link rel="preconnect" href="https://www.youtube.com">
    <link rel="preconnect" href="https://www.google.com">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ë§Œì˜ ìœ íŠœë¸Œ ì±…ì¥ (by. Joel Lee)</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.17.1/firebase-auth-compat.js"></script>

    <style>
        /* ğŸ¨ í…Œë§ˆ ë° ë³€ìˆ˜ ì„¤ì • */
        :root {
            --primary: #e50914;
            --bg: #141414;
            --sidebar-bg: #111;
            --card-bg: #1a1a1a;
            --text: #ffffff;
            --border: #333;
            --success: #2ecc71;
            --yt-grey: #2a2a2a;
            --notebook-bg: #4b5563;
            --input-bg: #222;
        }

        body.light-mode {
            --bg: #f9f9f9;
            --sidebar-bg: #ffffff;
            --card-bg: #ffffff;
            --text: #141414;
            --border: #dddddd;
            --yt-grey: #eeeeee;
            --input-bg: #ffffff;
        }

        body {
            font-family: 'Pretendard', -apple-system, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
            transition: 0.3s;
        }

        /* ğŸšª ë¡œê·¸ì¸ ì˜¤ë²„ë ˆì´ */
        #loginOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--bg); z-index: 9999; display: flex; flex-direction: column;
            justify-content: center; align-items: center; text-align: center;
        }

        /* ğŸ“ ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ */
        .sidebar {
            width: 320px;
            min-width: 320px;
            background: var(--sidebar-bg);
            border-right: 1px solid var(--border);
            padding: 25px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            box-sizing: border-box;
        }

        .logo {
            font-size: 24px;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 5px;
            letter-spacing: -1px;
        }

        /* ğŸ‘¤ ì‚¬ìš©ì í”„ë¡œí•„ ì˜ì—­ */
        .user-profile {
            padding: 15px; background: var(--input-bg); border-radius: 12px;
            margin-bottom: 20px; border: 1px solid var(--border);
        }
        .profile-nick { font-size: 16px; font-weight: bold; color: var(--primary); margin-bottom: 2px; }
        .profile-email { font-size: 11px; color: #666; margin-bottom: 10px; }

        .id-guide {
            font-size: 12px;
            color: #888;
            cursor: help;
            margin-bottom: 25px;
            position: relative;
        }
        .id-guide:hover::after {
            content: "ì›í•˜ëŠ” ì±„ë„ ë©”ì¸ > ì±„ë„ ì„¤ëª… ë”ë³´ê¸° > ì±„ë„ ê³µìœ  > ì±„ë„ ID ë³µì‚¬";
            position: absolute; left: 0; top: 25px;
            background: #333; color: #fff; padding: 10px 12px; border-radius: 6px;
            white-space: normal; max-width: 240px; line-height: 1.5;
            z-index: 1000; box-shadow: 0 4px 15px rgba(0,0,0,0.4);
        }

        .input-group { width: 100%; margin-bottom: 25px; box-sizing: border-box; }
        
        input[type="text"] {
            width: 100%; padding: 12px;
            background: var(--input-bg); border: 1px solid var(--border);
            color: var(--text); border-radius: 8px; margin-bottom: 10px;
            box-sizing: border-box; font-size: 14px;
        }

        .btn {
            width: 100%; padding: 12px;
            background: var(--primary); border: none;
            color: white; font-weight: bold; border-radius: 8px;
            cursor: pointer; font-size: 14px; transition: 0.2s;
            display: block; text-align: center; text-decoration: none; box-sizing: border-box;
        }
        .btn:hover { opacity: 0.9; transform: scale(0.98); }
        .btn-yt-find { background: var(--yt-grey); margin-top: 10px; border: 1px solid var(--border); color: var(--text); }
        .btn-logout { background: none; border: 1px solid #444; color: #888; padding: 5px 10px; font-size: 11px; border-radius: 4px; }

        .channel-list { flex: 1; margin-top: 10px; }
        .channel-item {
            padding: 12px; background: var(--input-bg);
            border-radius: 10px; margin-bottom: 10px; cursor: pointer;
            border: 1px solid var(--border); display: flex;
            justify-content: space-between; align-items: center;
        }

        .copyright {
            font-size: 11px; color: #777; padding-top: 20px;
            border-top: 1px solid var(--border);
        }

        /* ğŸ¬ ë©”ì¸ ì½˜í…ì¸  */
        .main-content { flex: 1; padding: 40px; overflow-y: auto; position: relative; }
        .theme-toggle { position: absolute; top: 30px; right: 40px; background: var(--yt-grey); border: 1px solid var(--border); color: var(--text); padding: 8px 15px; border-radius: 20px; cursor: pointer; font-size: 12px; font-weight: bold; z-index: 100; }

        .tab-menu { display: flex; gap: 20px; margin: 25px 0 35px 0; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        .tab-item { cursor: pointer; font-weight: bold; color: #777; transition: 0.3s; padding-bottom: 5px; border-bottom: 2px solid transparent; font-size: 15px; }
        .tab-item.active { color: var(--primary); border-color: var(--primary); }

        .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        .video-card { background: var(--card-bg); border-radius: 12px; overflow: hidden; cursor: pointer; transition: 0.3s; border: 1px solid var(--border); position: relative; }
        .video-card:hover { transform: translateY(-8px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .video-card img { width: 100%; display: block; }
        .video-info { padding: 15px; font-size: 14px; line-height: 1.5; font-weight: 500; }
        .shorts-badge { position: absolute; top: 10px; right: 10px; background: rgba(229, 9, 20, 0.9); color: white; padding: 3px 7px; border-radius: 4px; font-size: 11px; font-weight: bold; }

        /* ğŸ§  í†µí•© ë¶„ì„ ì„¼í„° */
        .analysis-center { display: none; margin-top: 40px; animation: fadeIn 0.5s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .unified-box { background: var(--card-bg); border-radius: 15px; border: 1px solid var(--border); padding: 30px; display: flex; flex-direction: column; gap: 25px; }
        .unified-title { font-size: 20px; font-weight: bold; border-bottom: 1px solid var(--border); padding-bottom: 15px; margin-bottom: 5px; }
        .step-item { display: flex; flex-direction: column; gap: 12px; }
        .step-label { font-size: 15px; font-weight: bold; color: #ddd; display: flex; align-items: center; gap: 8px; }
        .btn-link { display: inline-block; background: var(--notebook-bg); color: white; padding: 10px 20px; border-radius: 6px; text-decoration: none; font-weight: bold; font-size: 14px; width: fit-content; }
        .url-copy-wrapper { display: flex; align-items: center; gap: 10px; background: var(--bg); padding: 12px; border-radius: 8px; border: 1px solid var(--border); }
        .video-url-text { font-size: 13px; color: #aaa; flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .prompt-tabs { display: flex; gap: 10px; margin-top: 5px; }
        .prompt-tab-btn { padding: 8px 16px; background: var(--yt-grey); border: 1px solid var(--border); color: #ccc; border-radius: 6px; cursor: pointer; font-size: 13px; font-weight: bold; }
        .prompt-tab-btn.active { background: var(--primary); color: white; border-color: var(--primary); }
        .prompt-display-area { background: var(--bg); padding: 20px; border-radius: 10px; border: 1px solid var(--border); position: relative; }
        .prompt-text-pre { font-size: 14px; color: #ddd; white-space: pre-wrap; line-height: 1.7; margin: 0; }
        .copy-feedback { display: none; color: var(--success); font-size: 12px; font-weight: bold; margin-right: 10px; }
        
        .tips-section { margin-top: 10px; padding-top: 20px; border-top: 1px solid var(--border); }
        .tips-title { font-size: 14px; font-weight: bold; color: #888; margin-bottom: 15px; }
        .tips-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .tip-item { font-size: 12px; color: #777; line-height: 1.6; }
        .tip-label { font-weight: bold; color: #aaa; margin-bottom: 5px; display: block; }
        .btn-small { padding: 6px 12px; font-size: 12px; background: #444; color: white; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <div style="width: 320px;">
            <div class="logo" style="font-size: 40px; margin-bottom: 40px;">ë‚˜ë§Œì˜ ìœ íŠœë¸Œ ì±…ì¥</div>
            <button class="btn" onclick="handleLogin()">Googleë¡œ ë¡œê·¸ì¸í•˜ì—¬ ì‹œì‘í•˜ê¸°</button>
            <p style="color: #555; font-size: 12px; margin-top: 20px;">* êµ¬ê¸€ ê³„ì •ìœ¼ë¡œ ë‚˜ë§Œì˜ ì±…ì¥ì„ ë™ê¸°í™”í•©ë‹ˆë‹¤.</p>
        </div>
    </div>

    <aside class="sidebar">
        <div class="logo">ë‚˜ë§Œì˜ ìœ íŠœë¸Œ ì±…ì¥</div>
        
        <div class="user-profile" id="userProfile" style="display:none;">
            <div class="profile-nick" id="displayNickname">ë‹‰ë„¤ì„ë‹˜</div>
            <div class="profile-email" id="displayUserEmail">email@gmail.com</div>
            <button class="btn-logout" onclick="handleLogout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>

        <div class="id-guide">ğŸ’¡ ì±„ë„ ID í™•ì¸ë²• (ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦¬ì„¸ìš”)</div>
        
        <div class="input-group">
            <input type="text" id="chName" placeholder="ì±„ë„ ì´ë¦„ (ì˜ˆ: ì¹¨ì°©ë§¨)">
            <input type="text" id="chId" placeholder="ì±„ë„ ID (UC... / í™•ì¸ë²• ìœ„ ì°¸ì¡°)">
            <button class="btn" onclick="addChannel()">ì±„ë„ ë¦¬ìŠ¤íŠ¸ ì¶”ê°€</button>
            <a href="https://www.youtube.com" target="_blank" class="btn btn-yt-find" style="text-decoration:none;">Youtubeì—ì„œ ì°¾ì•„ë³´ê¸°</a>
        </div>

        <div class="channel-list" id="channelList"></div>

        <div class="copyright">
            Â©2026. ì´ìŠ¹ë§Œ (Joel Lee) All rights reserved.
        </div>
    </aside>

    <main class="main-content">
        <button class="theme-toggle" onclick="toggleTheme()">â˜€ï¸ ëª¨ë“œ ì „í™˜</button>
        <h1 id="mainTitle" style="font-size: 28px;">ì±…ì¥ì—ì„œ ì±„ë„ì„ ê³¨ë¼ì£¼ì„¸ìš”.</h1>

        <div class="tab-menu" id="tabMenu" style="display:none;">
            <div class="tab-item active" onclick="filterVideos('ALL')">ì „ì²´ ì˜ìƒ</div>
            <div class="tab-item" onclick="filterVideos('VIDEO')">ì¼ë°˜ ë™ì˜ìƒ</div>
            <div class="tab-item" onclick="filterVideos('SHORTS')">Shorts</div>
        </div>

        <div class="video-grid" id="videoGrid"></div>
        <div style="text-align: center; margin-top: 30px;">
            <button id="loadMoreBtn" class="btn btn-yt-find" style="display:none; width:auto; padding: 12px 50px; border-radius: 30px;" onclick="loadMoreVideos()">ì´ì „ ì˜ìƒ ë” ë¶ˆëŸ¬ì˜¤ê¸° â†“</button>
        </div>

        <div class="analysis-center" id="analysisCenter">
            <iframe id="mainPlayer" width="100%" height="550" frameborder="0" allowfullscreen style="border-radius: 15px; margin-bottom: 25px; border: 1px solid var(--border);"></iframe>
            
            <div class="unified-box">
                <div class="unified-title">ìœ„ ì˜ìƒì„ ë¶„ì„í•˜ë ¤ë©´?</div>
                <div class="step-item">
                    <div class="step-label">1. NotebookLM ì ‘ì†í•˜ê¸°</div>
                    <a href="https://notebooklm.google.com" target="_blank" class="btn-link">NotebookLM ì ‘ì†í•˜ê¸°</a>
                </div>
                <div class="step-item">
                    <div class="step-label">2. ë¡œê·¸ì¸ â†’ 'ìƒˆë¡œ ë§Œë“¤ê¸°' â†’ 'ì›¹ì‚¬ì´íŠ¸' ë²„íŠ¼ í´ë¦­ í›„ ìœ íŠœë¸Œ ë§í¬ ë¶™ì—¬ë„£ê¸°</div>
                    <div class="url-copy-wrapper">
                        <span id="currentVideoUrl" class="video-url-text">ì˜ìƒì„ ì„ íƒí•˜ë©´ ë§í¬ê°€ í‘œì‹œë©ë‹ˆë‹¤.</span>
                        <span id="linkFeedback" class="copy-feedback">âœ” ë³µì‚¬ ì™„ë£Œ</span>
                        <button class="btn-small" onclick="copyLink()">ë§í¬ ë³µì‚¬</button>
                    </div>
                </div>
                <div class="step-item">
                    <div class="step-label">3. ì•„ë˜ í”„ë¡¬í”„íŠ¸ ì¤‘ ê³ ë¥´ê±°ë‚˜, ë³¸ì¸ë§Œì˜ í”„ë¡¬í”„íŠ¸ë¡œ ë¶„ì„ ìš”ì²­</div>
                    <div class="prompt-tabs">
                        <button class="prompt-tab-btn active" onclick="selectPrompt('summary', this)">[ë‚´ìš© ìš”ì•½]</button>
                        <button class="prompt-tab-btn" onclick="selectPrompt('insight', this)">[ì¸ì‚¬ì´íŠ¸]</button>
                        <button class="prompt-tab-btn" onclick="selectPrompt('creative', this)">[2ì°¨ ì°½ì‘]</button>
                    </div>
                    <div class="prompt-display-area">
                        <div style="position: absolute; top: 15px; right: 15px; display: flex; align-items: center;">
                            <span id="promptFeedback" class="copy-feedback">âœ” ë³µì‚¬ ì™„ë£Œ</span>
                            <button class="btn-small" onclick="copyPrompt()">í”„ë¡¬í”„íŠ¸ ë³µì‚¬</button>
                        </div>
                        <pre id="promptText" class="prompt-text-pre"></pre>
                    </div>
                </div>
                <div class="tips-section">
                    <div class="tips-title">AI í”„ë¡¬í”„íŠ¸ ì‹¤ì „ íŒ</div>
                    <div class="tips-grid">
                        <div class="tip-item"><span class="tip-label">1. ì—­í•  ë¶€ì—¬ (#ì—­í• )</span>AIì—ê²Œ êµ¬ì²´ì ì¸ 'ê°€ë©´'ì„ ì”Œì›Œì£¼ëŠ” ë‹¨ê³„ì…ë‹ˆë‹¤. - ì˜ˆì‹œ: "ë„ˆëŠ” IT ì „ë¬¸ ë¦¬ë·°ì–´ì•¼."</div>
                        <div class="tip-item"><span class="tip-label">2. ëª©í‘œ ëª…í™•í™” (#ëª©í‘œ)</span>AIê°€ 'ë¬´ì—‡'ì„ 'ì–´ë–»ê²Œ' ë‚´ë†“ì•„ì•¼ í• ì§€ ì§€ì •í•©ë‹ˆë‹¤. - ì˜ˆì‹œ: "3ë‹¨ êµ¬ì„±ìœ¼ë¡œ ìš”ì•½í•´ì¤˜."</div>
                        <div class="tip-item"><span class="tip-label">3. ì œì•½ ì‚¬í•­ ì„¤ì • (#í•˜ì§€ ë§ ê²ƒ)</span>AIì˜ í™˜ê°ì„ ë°©ì§€í•©ë‹ˆë‹¤. - ì˜ˆì‹œ: "ì–¸ê¸‰ë˜ì§€ ì•Šì€ ì‚¬ì‹¤ì€ ì§€ì–´ë‚´ì§€ ë§ˆ."</div>
                    </div>
                </div>
            </div>
        </div>
    </main>

<script>
    // ğŸ”‘ 1. Firebase ì„¤ì • (ì¡°ì—˜ë‹˜ì˜ ì½˜ì†”ì—ì„œ ë³µì‚¬í•œ ê²ƒìœ¼ë¡œ êµì²´í•˜ì„¸ìš”!)
    const firebaseConfig = {
  apiKey: "AIzaSyBQQybMmOhpRboyWATt-OyaSCMNzrIJcvA",
  authDomain: "secretary-ceffe.firebaseapp.com",
  projectId: "secretary-ceffe",
  storageBucket: "secretary-ceffe.firebasestorage.app",
  messagingSenderId: "868361198340",
  appId: "1:868361198340:web:72aaf02c0831cc20308e51",
  measurementId: "G-6XGS20JMKW"
};

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const provider = new firebase.auth.GoogleAuthProvider();

    // ğŸ”‘ 2. ë³€ìˆ˜ ë° DB ì‹œìŠ¤í…œ
    let currentUser = localStorage.getItem('vibe_current_user') || null;
    let allUsersData = JSON.parse(localStorage.getItem('vibe_users_db')) || {};

    const YOUTUBE_API_KEY = 'AIzaSyBSJOPgrN_Hj4wK_5Ro0q0ObR-vxjHvwr8'; 
    let currentChannelId = "";
    let nextPageToken = "";
    let allLoadedVideos = [];
    let currentFilter = 'ALL';
    let currentVideo = null;

    const promptLibrary = {
        summary: `ì œê³µëœ ìœ íŠœë¸Œ ì˜ìƒ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ë°”íƒ•ìœ¼ë¡œ ë‚´ìš©ì„ ìš”ì•½í•´ì¤˜.\n1. í•œ ì¤„ ìš”ì•½: ì´ ì˜ìƒì´ ì „ì²´ì ìœ¼ë¡œ ë¬´ì—‡ì„ ë§í•˜ëŠ”ì§€ í•œ ë¬¸ì¥ìœ¼ë¡œ ì •ì˜í•´ì¤˜.\n2. í•µì‹¬ í‚¤ì›Œë“œ: ì˜ìƒì˜ ì£¼ì œë¥¼ ê´€í†µí•˜ëŠ” í‚¤ì›Œë“œ 3~5ê°œë¥¼ ë½‘ì•„ì¤˜.\n3. íƒ€ì„ë¼ì¸ë³„ ìš”ì§€: ì„¹ì…˜ë³„ í•µì‹¬ ë‚´ìš©ì„ ë¶ˆë ›í¬ì¸íŠ¸ë¡œ ì •ë¦¬í•´ì¤˜.\n4. ê²°ë¡ : ìœ íŠœë²„ê°€ ë§ˆì§€ë§‰ìœ¼ë¡œ ê°•ì¡°í•˜ëŠ” ë©”ì‹œì§€ëŠ” ë­ì•¼?`,
        insight: `ì´ ì˜ìƒì˜ ë‚´ìš©ì„ ë¶„ì„í•´ì„œ ë‹¨ìˆœ ìš”ì•½ ì´ìƒì˜ ê¹Šì´ ìˆëŠ” í†µì°°ì„ ë½‘ì•„ì¤˜.\n1. í•µì‹¬ ìš”ì•½: ì˜ìƒì˜ í•µì‹¬ ë…¼ë¦¬ë¥¼ ê°„ëµíˆ ì •ë¦¬í•´ì¤˜.\n2. ìˆ¨ê²¨ì§„ ì˜ë„/ë§¥ë½: ì´ ì •ë³´ê°€ ì™œ ì¤‘ìš”í•œì§€ ë³¸ì§ˆì ì¸ ê°€ì¹˜ë¥¼ ë¶„ì„í•´ì¤˜.\n3. ì‹¤í–‰ ê°€ëŠ¥í•œ ì¸ì‚¬ì´íŠ¸: ë‹¹ì¥ ì‹¤ìƒí™œì— ì ìš©í•´ë³¼ ìˆ˜ ìˆëŠ” ë°©ë²• 3ê°€ì§€ë¥¼ ì œì•ˆí•´ì¤˜.\n4. ë¹„íŒì  ì‹œê°: ì¶”ê°€ë¡œ ê²€ì¦ì´ í•„ìš”í•œ ë¶€ë¶„ì´ ìˆë‹¤ë©´ ë¬´ì—‡ì¼ê¹Œ?`,
        creative: `ì œê³µëœ ì˜ìƒì˜ ë©”ì‹œì§€ëŠ” ìœ ì§€í•˜ë˜, ì „í˜€ ë‹¤ë¥¸ í˜•íƒœì˜ ì½˜í…ì¸ ë¡œ ì¬êµ¬ì„±í•´ì¤˜.\n1. ìƒˆë¡œìš´ êµ¬ì¡°: (ì˜ˆ: Q&A ë°©ì‹ / ìŠ¤í† ë¦¬í…”ë§ ë°©ì‹)ìœ¼ë¡œ êµ¬ì¡°ë¥¼ ë³€ê²½í•´ì¤˜.\n2. ì˜ˆì‹œ ë³€í˜•: (ì˜ˆ: í•œêµ­ì˜ ì§ì¥ì¸)ì´ ê³µê°í•  ìˆ˜ ìˆëŠ” ìƒˆë¡œìš´ ì‚¬ë¡€ë¥¼ ë“¤ì–´ì¤˜.\n3. í•µì‹¬ ë©”ì‹œì§€ ê°•ì¡°: ë§íˆ¬ëŠ” (ì˜ˆ: ë‹¨í˜¸í•œ ë§íˆ¬)ë¡œ ë°”ê¿”ì„œ ì‘ì„±í•´ì¤˜.\n4. ì œëª© ì œì•ˆ: ë§¤ë ¥ì ì¸ ì œëª© 3ê°€ì§€ë¥¼ ë½‘ì•„ì¤˜.`
    };

    window.onload = () => {
        if (currentUser && allUsersData[currentUser]) {
            showApp();
        } else {
            document.getElementById('loginOverlay').style.display = 'flex';
        }
        selectPrompt('summary', document.querySelector('.prompt-tab-btn'));
    };

    // ğŸ”‘ ë¡œê·¸ì¸/ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
    function handleLogin() {
        auth.signInWithPopup(provider).then((result) => {
            const user = result.user;
            currentUser = user.uid;
            localStorage.setItem('vibe_current_user', currentUser);
            if (!allUsersData[currentUser]) {
                allUsersData[currentUser] = { nickname: user.displayName, email: user.email, channels: [] };
            }
            saveToDB();
            showApp();
        }).catch((e) => alert("ë¡œê·¸ì¸ ì‹¤íŒ¨!"));
    }

    function handleLogout() {
        auth.signOut().then(() => {
            localStorage.removeItem('vibe_current_user');
            location.reload();
        });
    }

    function showApp() {
        document.getElementById('loginOverlay').style.display = 'none';
        document.getElementById('userProfile').style.display = 'block';
        const data = allUsersData[currentUser];
        document.getElementById('displayNickname').textContent = data.nickname + " ë‹˜";
        document.getElementById('displayUserEmail').textContent = data.email;
        renderChannels();
    }

    function saveToDB() { localStorage.setItem('vibe_users_db', JSON.stringify(allUsersData)); }

    function addChannel() {
        const name = document.getElementById('chName').value.trim();
        const id = document.getElementById('chId').value.trim();
        if(!name || !id) return alert("ì…ë ¥í•˜ì„¸ìš”.");
        allUsersData[currentUser].channels.push({name, id});
        saveToDB();
        renderChannels();
    }

    function renderChannels() {
        const list = document.getElementById('channelList');
        const userChannels = allUsersData[currentUser].channels || [];
        list.innerHTML = userChannels.map((c, i) => `
            <div class="channel-item" onclick="initLoad('${c.id}', '${c.name}')">
                <b>${c.name}</b><span style="color:#888; font-size:18px;" onclick="event.stopPropagation(); removeChannel(${i})">Ã—</span>
            </div>`).join('');
    }

    function removeChannel(i) {
        if(confirm("ì‚­ì œí• ê¹Œìš”?")) {
            allUsersData[currentUser].channels.splice(i, 1);
            saveToDB();
            renderChannels();
        }
    }

    // [ì´í•˜ ê¸°ì¡´ v1.3 ë¡œì§ ìœ ì§€]
    async function initLoad(id, name) {
        currentChannelId = id; nextPageToken = ""; allLoadedVideos = [];
        document.getElementById('mainTitle').textContent = `ğŸ“š ${name} ì½”ë„ˆ`;
        document.getElementById('videoGrid').innerHTML = "";
        document.getElementById('tabMenu').style.display = 'flex';
        document.getElementById('analysisCenter').style.display = 'none';
        await loadMoreVideos();
    }

    async function loadMoreVideos() {
        const playlistId = currentChannelId.replace('UC', 'UU');
        let url = `https://www.googleapis.com/youtube/v3/playlistItems?part=snippet&maxResults=15&playlistId=${playlistId}&key=${YOUTUBE_API_KEY}`;
        if (nextPageToken) url += `&pageToken=${nextPageToken}`;
        try {
            const response = await fetch(url);
            const data = await response.json();
            nextPageToken = data.nextPageToken || "";
            const videoIds = data.items.map(item => item.snippet.resourceId.videoId).join(',');
            const detailRes = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=contentDetails,snippet&id=${videoIds}&key=${YOUTUBE_API_KEY}`);
            const detailData = await detailRes.json();
            const newVideos = data.items.map(item => {
                const details = detailData.items.find(d => d.id === item.snippet.resourceId.videoId);
                const durationSeconds = parseISO8601Duration(details.contentDetails.duration);
                return {
                    id: item.snippet.resourceId.videoId,
                    title: item.snippet.title,
                    thumb: item.snippet.thumbnails.medium.url,
                    type: durationSeconds <= 60 ? 'SHORTS' : 'VIDEO'
                };
            });
            allLoadedVideos = [...allLoadedVideos, ...newVideos];
            filterVideos(currentFilter);
            document.getElementById('loadMoreBtn').style.display = nextPageToken ? 'inline-block' : 'none';
        } catch(e) { console.error(e); }
    }

    function parseISO8601Duration(d) {
        const match = d.match(/PT(?:(\d+)H)?(?:(\d+)M)?(?:(\d+)S)?/);
        return (parseInt(match[1]||0)*3600) + (parseInt(match[2]||0)*60) + parseInt(match[3]||0);
    }

    function filterVideos(type) {
        currentFilter = type;
        const filtered = allLoadedVideos.filter(v => type === 'ALL' || v.type === type);
        document.getElementById('videoGrid').innerHTML = filtered.map(v => `
            <div class="video-card" onclick="playVideo('${v.id}', '${v.title.replace(/'/g, "")}')">
                <img src="${v.thumb}">${v.type === 'SHORTS' ? '<div class="shorts-badge">SHORTS</div>' : ''}
                <div class="video-info">${v.title}</div>
            </div>`).join('');
    }

    function playVideo(id, title) {
        currentVideo = { id, title, url: `https://www.youtube.com/watch?v=${id}` };
        document.getElementById('mainPlayer').src = `https://www.youtube.com/embed/${id}?autoplay=1`;
        document.getElementById('currentVideoUrl').textContent = currentVideo.url;
        document.getElementById('analysisCenter').style.display = 'block';
        document.getElementById('analysisCenter').scrollIntoView({ behavior: 'smooth' });
    }

    function selectPrompt(key, btn) {
        document.querySelectorAll('.prompt-tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.getElementById('promptText').textContent = promptLibrary[key];
    }

    function copyPrompt() { navigator.clipboard.writeText(document.getElementById('promptText').textContent).then(() => showFb('promptFeedback')); }
    function copyLink() { if(currentVideo) navigator.clipboard.writeText(currentVideo.url).then(() => showFb('linkFeedback')); }
    function showFb(id) { const fb = document.getElementById(id); fb.style.display='inline'; setTimeout(()=>fb.style.display='none', 2000); }
    function toggleTheme() { document.body.classList.toggle('light-mode'); }
</script>
</body>
</html>